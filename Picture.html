<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Photobooth</title>
  <link rel="stylesheet" href="Photobooth.css">
</head>
<body>
<div class="video-container">
  <video id="video" autoplay></video>
  <div id="countdown"></div>
  <button id="start" class="button2">
    <img src="elements/TakePics.png" alt="Start Capture" style="width:90px;height:60px;">
  </button>
  <!-- ✅ Filters inside video-container -->
  <div class="filters">
    <div class="filter-header">FILTER</div>
    <button class="filter-btn" data-filter="none" style="background-color: #E0D7CC;"></button>
    <button class="filter-btn" data-filter="grayscale(100%)" style="background-color: #57524b;"></button>
    <button class="filter-btn" data-filter="sepia(100%)" style="background-color: #8B4513;"></button>
    <button class="filter-btn" data-filter="contrast(200%)" style="background-color: #392418;"></button>
  </div>
  <div class="photo-strip" id="gallery"></div>
</div>
<canvas id="canvas" width="640" height="480" style="display:none;"></canvas>

  <script>
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  const startBtn = document.getElementById('start');
  const gallery = document.getElementById('gallery');
  const countdown = document.getElementById('countdown');
  const clearBtn = document.getElementById('clear'); // make sure you have a clear button in HTML
  let photoCount = 0;
  let currentFilter = "none"; // keep track of selected filter

// Filter buttons
const filterButtons = document.querySelectorAll(".filter-btn");
filterButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    currentFilter = btn.getAttribute("data-filter");
    video.style.filter = currentFilter; // apply to live video
  });
});

  // Access webcam
  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => {
      video.srcObject = stream;
    })
    .catch(err => console.error("Error accessing camera: ", err));

  // Preload 6 empty slots in gallery
  for (let i = 0; i < 6; i++) {
    const placeholder = document.createElement('img');
    placeholder.src = "data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";
    placeholder.classList.add('placeholder');
    gallery.appendChild(placeholder);
  }

  startBtn.addEventListener('click', () => {
    let timeLeft = 3; // countdown seconds

    function runCountdown() {
      countdown.style.display = 'block';
      countdown.textContent = timeLeft;

      const timer = setInterval(() => {
        timeLeft--;
        if (timeLeft > 0) {
          countdown.textContent = timeLeft;
        } else {
          clearInterval(timer);
          countdown.style.display = 'none';

          // Take photo
const context = canvas.getContext('2d');

// ✅ Flip canvas horizontally before drawing
context.save();
context.translate(canvas.width, 0);
context.scale(-1, 1);

// ✅ Apply the current filter to the canvas
context.filter = currentFilter;

context.drawImage(video, 0, 0, canvas.width, canvas.height);

context.restore();

const imageData = canvas.toDataURL("image/png");

          const slot = gallery.children[photoCount];
          slot.src = imageData;
          slot.classList.remove('placeholder');
          slot.classList.add('active');

          // Scroll the new photo into view
          slot.scrollIntoView({ behavior: "smooth", inline: "center" });

          // Remove highlight from previous photo
          if (photoCount > 0) {
            gallery.children[photoCount - 1].classList.remove('active');
          }

          photoCount++;

          if (photoCount < 6) {
            timeLeft = 3; // reset countdown
            setTimeout(runCountdown, 1000); // start next countdown
          } else {
            // Save all photos to localStorage
            const images = Array.from(document.querySelectorAll('#gallery img'))
                                .map(img => img.src);
            localStorage.setItem("capturedPhotos", JSON.stringify(images));

            // Redirect to next page
            window.location.href = "choose.html";
          }
        }
      }, 1000);
    }

    runCountdown();
  });

  clearBtn.addEventListener('click', () => {
    gallery.innerHTML = '';
    photoCount = 0;
    // Recreate placeholders
    for (let i = 0; i < 6; i++) {
      const placeholder = document.createElement('img');
      placeholder.src = '';
      placeholder.classList.add('placeholder');
      gallery.appendChild(placeholder);
    }
  });
</script>
</body>
</html>